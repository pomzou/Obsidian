# OSPF Multi Area ラボまとめ

## 要件定義

**目的:** OSPF Multi Areaが正常に動作するネットワークを構築する。

**構成要件:**

- ルーター5台（R1〜R5）、ホスト2台（host1、host2）
- Area 0（バックボーン）: R2、R3
- Area 1: R1、R2（R2がABR）
- Area 2: R3、R4、R5（R3がABR）
- 全ルーターにLoopbackを設定
- host1（192.168.10.1/24）はR1配下
- host2（192.168.20.1/24）はR5配下
- host1↔host2のpingが通ること

**IPアドレス設計:**

```
R1: Lo0=1.1.1.1/32, Eth0/1=192.168.10.254/24, Eth0/2=10.0.12.1/30
R2: Lo0=2.2.2.2/32, Eth0/1=10.0.12.2/30,      Eth0/2=10.0.23.1/30
R3: Lo0=3.3.3.3/32, Eth0/1=10.0.23.2/30,      Eth0/2=10.0.34.1/30
R4: Lo0=4.4.4.4/32, Eth0/1=10.0.34.2/30,      Eth0/2=10.0.45.1/30
R5: Lo0=5.5.5.5/32, Eth0/1=192.168.20.254/24, Eth0/2=10.0.45.2/30
host1: 192.168.10.1/24, GW=192.168.10.254
host2: 192.168.20.1/24, GW=192.168.20.254
```

**構成図:**

![[Pasted image 20260215033108.png]]
---

## Single Area との違い

### なぜエリアを分けるか

Single Areaで100台のルーターが全部Area 0にいる場合、1台の経路情報が変わると全ルーターにLSA（Link State Advertisement）がフラッディングされて全台が再計算する。ルーターが増えるほど処理が重くなる。

エリアを分けることで再計算をエリア内に閉じ込められる。

### LSAフラッディング

OSPFがネットワーク情報を伝える仕組み。エリア内でフラッディングされる。エリアを分けることでフラッディングの範囲を限定できる。

---

## 重要な概念

### Area 0（バックボーン）が必須な理由

全エリアは必ずArea 0に繋がってないといけない。Area 0を経由することでルーティングループを防ぐ。STPがルートブリッジを中心にツリーを作るのと同じ考え方。

```
Area 1 --- ABR --- Area 0 --- ABR --- Area 2
```

Area 1とArea 2は直接繋がらない。必ずArea 0を経由する。

### ABR（Area Border Router）

エリアとエリアの境界にいるルーター。両方のエリアに所属して経路情報を要約して伝える。

**確認コマンド:**

```
show ip ospf
```

`It is an area border router`と表示されればABR。

### O IA（OSPF Inter Area）

他のエリアから学習した経路。ルーティングテーブルで`O IA`と表示される。

```
O IA  10.0.23.0/30 [110/20] via 10.0.12.2
```

### ip ospf network point-to-point

/30のルーター間リンクに設定する。「このリンクは2台だけ繋がってる」という意味でDR/BDR選出が不要になり効率が良くなる。

```
interface Ethernet0/2
 ip ospf network point-to-point
```

---

## 今回のハマりポイント

### ホストとルーター間もOSPFに参加させる必要がある

**間違い:**

```
router ospf 1
 network 10.0.45.0 0.0.0.3 area 2  ← ルーター間だけ
```

**正しい:**

```
router ospf 1
 network 10.0.45.0 0.0.0.3 area 2
 network 192.168.20.0 0.0.0.255 area 2  ← ホスト向けも必要
```

**理由:** OSPFは「自分が直接繋がってるネットワーク」を他のルーターに広報する。ホスト向けのインターフェースをOSPFに入れないと、他のルーターはそのネットワークの存在を知れない。

**ルール: ルーターの全インターフェースをOSPFに参加させる（管理用eth0を除く）**

### ホスト向けインターフェースのエリア

隣のルーター間リンクと同じエリアに入れる。

```
R1はArea 1 → host1向けEth0/1もArea 1
R5はArea 2 → host2向けEth0/1もArea 2
```

---

## networkコマンド vs インターフェース直接指定

### 従来の書き方（networkコマンド）

```
router ospf 1
 network 10.0.12.0 0.0.0.3 area 1
```

### 新しい書き方（インターフェース直接指定）

```
interface Ethernet0/2
 ip ospf 1 area 1
```

どちらも同じ動作。インターフェース直接指定の方が「このインターフェースがどのエリアか」が一目でわかるため最近好まれる。

---

## OSPF Multi Area 正常動作チェックリスト

- [ ]  全インターフェースがupか（show ip interface brief）
- [ ]  OSPFネイバーがFULL状態か（show ip ospf neighbor）
- [ ]  ABRに`It is an area border router`が表示されるか（show ip ospf）
- [ ]  ルーティングテーブルにO IAの経路が載ってるか（show ip route）
- [ ]  全ルーターのLoopbackがRouter IDになってるか（show ip ospf）
- [ ]  host1↔host2のpingが通るか

---

## 使用したコマンド

```
# OSPFの状態確認（Router ID、ABRかどうか）
show ip ospf

# ネイバー確認
show ip ospf neighbor

# ルーティングテーブル（OSPFのみ）
show ip route ospf

# インターフェース確認
show ip interface brief

# OSPF設定確認
show running-config | section ospf
```

---

## 次のラボ