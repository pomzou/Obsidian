# EtherChannel / LACP ラボまとめ

## 要件定義

**目的:** LACPを使ったEtherChannelを構築して冗長性と帯域増加を確認する。

**構成要件:**

- スイッチ2台（sw1、sw2）
- sw1-sw2間を2本のリンクでEtherChannel（LACP）で束ねる
- host1（192.168.10.1/24）はsw1配下
- host2（192.168.10.2/24）はsw2配下
- host1↔host2のpingが通ること

**構成図:**

![[Pasted image 20260217213633.png]]
---

## 基本概念

### EtherChannelとは

複数の物理リンクを1本の論理リンクに束ねる技術。

**メリット:**

- **冗長性:** 1本落ちても残りのリンクで通信継続
- **帯域増加:** 1本10Mbpsの2本束ね → 20Mbps

### LACPとEtherChannelの関係

```
EtherChannel = 複数リンクを1本に束ねる技術の総称（Cisco用語）
LACP = EtherChannelを実現するためのネゴシエーションプロトコル（IEEE標準）
```

|モード|説明|用途|
|---|---|---|
|LACP（802.3ad）|IEEE標準、自動ネゴシエーション|マルチベンダー環境（推奨）|
|PAgP|Cisco独自|Cisco同士のみ|
|Static（on）|ネゴシエーションなし|シンプルな構成|

**実務ではLACPが標準。** マルチベンダー環境で使えるから。

---

## 設定方法

### LACPの設定

```
interface range Ethernet0/2 - 3
 channel-group 1 mode active
```

- `mode active`: LACPを積極的にネゴシエーション（推奨）
- `mode passive`: 相手からのLACPを待つ
- `mode on`: ネゴシエーションなし（Static）

**両端ともactiveか、片方active/片方passiveにする。両方passiveはNG。**

---

## show etherchannel summaryの読み方

```
Group  Port-channel  Protocol    Ports
1      Po1(SU)       LACP        Et0/2(P)  Et0/3(P)
```

**Port-channelのフラグ:**

- `S` = Layer2
- `U` = in use（使用中）

**ポートのフラグ:**

- `P` = bundled（束ねられてる、正常）
- `D` = down（落ちてる）
- `I` = stand-alone（単独動作）

---

## フェールオーバーテスト結果

**テスト:** Et0/2をshutdownしてpingへの影響を確認

**結果:**

- Et0/2がdown → `P`から`D`に変化
- Et0/3が残ってるのでPort-channelは維持
- pingは一瞬止まるが復旧する
- no shutdownで即座に2本に戻る

**帯域の変化:**

```
通常時: BW 20000 Kbit/sec（2本 × 10Mbps）
1本down時: BW 10000 Kbit/sec（1本 × 10Mbps）
```

---

## EtherChannel正常動作チェックリスト

- [ ] Port-channelが`SU`状態か（show etherchannel summary）
- [ ] 全ポートが`P`状態か（show etherchannel summary）
- [ ] 帯域が正しいか（show interface Port-channel1）
- [ ] host1↔host2のpingが通るか
- [ ] 1本落としても通信が維持されるか（フェールオーバーテスト）

---

## 使用したコマンド

```
# EtherChannelの状態確認
show etherchannel summary

# Port-channelの詳細（帯域確認）
show interface Port-channel1

# LACPネゴシエーションの詳細
show lacp neighbor
show lacp internal
```

---

## 実務での使い方

|用途|例|
|---|---|
|サーバー↔スイッチ|10GbE × 4本 = 40Gbps|
|スイッチ間アップリンク|冗長性 + 帯域増加|
|データセンターのコアスイッチ|100GbE × 複数本|

---

## 次のラボ

DHCP / NAT